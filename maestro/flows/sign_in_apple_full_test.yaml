# Full Sign in with Apple Test - End-to-End Flow
# Tests that closing the system "Sign in to Apple Account" dialog
# doesn't show an error in our app

appId: com.dailypointer
---
- launchApp:
    clearState: true

# === COMPLETE ONBOARDING ===
- tapOn:
    text: "Continue"
- tapOn:
    text: "Continue"
- tapOn:
    text: "Continue"
- tapOn:
    text: "Maybe Later"
    optional: true
- tapOn:
    text: "Enable Notifications"
    optional: true

# === NAVIGATE TO SETTINGS ===
- tapOn:
    text: ".*Settings.*"
- takeScreenshot: "full_test_01_settings"

# === SCROLL TO ACCOUNT SECTION ===
- swipe:
    direction: UP
    duration: 500
- takeScreenshot: "full_test_02_scrolled"

# === TAP SIGN IN ===
- tapOn:
    text: ".*Sign.*"
- takeScreenshot: "full_test_03_signin_sheet"

# === TAP CONTINUE WITH APPLE ===
- tapOn:
    text: "Continue with Apple"
- takeScreenshot: "full_test_04_apple_dialog"

# === WAIT FOR SYSTEM DIALOG ===
- extendedWaitUntil:
    visible: "Close"
    timeout: 5000

# === TAP CLOSE ON SYSTEM DIALOG ===
- tapOn:
    text: "Close"
- takeScreenshot: "full_test_05_after_close"

# === WAIT AND VERIFY NO ERROR ===
- extendedWaitUntil:
    visible: ".*"
    timeout: 2000
- takeScreenshot: "full_test_06_final"

# === VERIFY NO ERROR MESSAGE IN SIGN IN SHEET ===
# The sheet should still be visible without an error banner
- assertNotVisible:
    text: ".*error.*"
    optional: true
